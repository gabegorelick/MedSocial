/*
 * Ext.ux.TouchCalendar
 */
Ext.ux.TouchCalendar=Ext.extend(Ext.Carousel,{enableSwipeNavigate:true,enableSimpleEvents:false,enableEventBars:false,viewConfig:{},defaultViewConfig:{mode:"MONTH",weekStart:1,bubbleEvents:["selectionchange"]},indicator:false,initComponent:function(){this.viewConfig=Ext.applyIf(this.viewConfig||{},this.defaultViewConfig);this.viewConfig.currentDate=this.viewConfig.currentDate||this.viewConfig.value||new Date();this.mode=this.viewConfig.mode.toUpperCase();this.initViews();Ext.apply(this,{cls:"touch-calendar",activeItem:(this.enableSwipeNavigate?1:0),direction:"horizontal"});Ext.ux.TouchCalendar.superclass.initComponent.call(this);this.on("selectionchange",this.onSelectionChange)},getViewConfig:function(b){var a=[];if(this.enableSimpleEvents){a.push(new Ext.ux.TouchCalendarSimpleEvents())}else{if(this.enableEventBars){a.push(new Ext.ux.TouchCalendarEvents())}}Ext.apply(this.viewConfig,{plugins:a,currentDate:b,onTableHeaderTap:Ext.createDelegate(this.onTableHeaderTap,this)});return this.viewConfig},getViewDate:function(a,b){var d=(this.mode==="WEEK"?"DAY":this.mode.toUpperCase()),c=(this.mode==="WEEK"?(8*b):b);return a.add(Date[d],c)},initViews:function(){this.items=[];var e=this.viewConfig.currentDate.clone(),c=(this.enableSwipeNavigate?-1:0),a=(this.enableSwipeNavigate?1:0),b=[];var d=this.getViewDate(e,-1);this.items.push(new Ext.ux.TouchCalendarView(Ext.applyIf({currentDate:d},this.getViewConfig(d))));this.items.push(new Ext.ux.TouchCalendarView(this.getViewConfig(e)));d=this.getViewDate(e,1);this.items.push(new Ext.ux.TouchCalendarView(Ext.applyIf({currentDate:d},this.getViewConfig(d))));this.view=this.items[(this.enableSwipeNavigate?1:0)]},onTableHeaderTap:function(b,a){a=Ext.fly(a);if(a.hasCls(this.view.prevPeriodCls)||a.hasCls(this.view.nextPeriodCls)){this[(a.hasCls(this.view.prevPeriodCls)?"prev":"next")]()}},setMode:function(a){this.mode=a.toUpperCase();this.viewConfig.mode=this.mode;this.items.each(function(b,c){b.currentDate=this.getViewDate(this.view.currentDate.clone(),c-1);if(c!==1){b.value}b.setMode(a)},this)},getValue:function(){var a=this.view.getSelectionModel().selected;return(a.getCount()>0)?a.first().get("date"):null},setValue:function(a){this.view.setValue(a)},afterRender:function(){Ext.Carousel.superclass.afterRender.call(this);if(this.enableSwipeNavigate){this.mon(this.body,{drag:this.onDrag,dragThreshold:5,dragend:this.onDragEnd,direction:this.direction,scope:this});this.el.addCls(this.baseCls+"-"+this.direction)}},onCardSwitch:function(a,d,b,e){if(this.enableSwipeNavigate){var c=this.items.indexOf(a),g=this.items.indexOf(d),f=(c>g)?"forward":"backward";this.counter=(this.counter||0)+1;if(f==="forward"){this.remove(this.items.get(0));this.add(new Ext.ux.TouchCalendarView(this.getViewConfig(a.currentDate.add(Date[this.mode],1))))}else{this.remove(this.items.get(this.items.getCount()-1));this.insert(0,new Ext.ux.TouchCalendarView(this.getViewConfig(a.currentDate.add(Date[this.mode],-1))))}this.doLayout();this.view=a}Ext.ux.TouchCalendar.superclass.onCardSwitch.apply(this,arguments)}});Ext.ux.TouchCalendarView=Ext.extend(Ext.DataView,{cls:"touch-calendar-view",weekStart:1,mode:"month",todayCls:"today",selectedItemCls:"selected",unselectableCls:"unselectable",prevMonthCls:"prev-month",nextMonthCls:"next-month",weekendCls:"weekend",prevPeriodCls:"goto-prev",nextPeriodCls:"goto-next",dayTimeSlotSize:30,itemSelector:"td.time-block",commonTemplateFunctions:{getClasses:function(a){var b=[];if(a.selected){b.push(this.me.selectedCls)}if(a.unselectable){b.push(this.me.unselectableCls)}if(a.prevMonth){b.push(this.me.prevMonthCls)}if(a.nextMonth){b.push(this.me.nextMonthCls)}if(a.weekend){b.push(this.me.weekendCls)}if(a.today){b.push(this.me.todayCls)}return b.join(" ")},isEndOfRow:function(a){return(a%7)===0&&(a>0)},isStartOfRow:function(a){return((a-1)%7)===0&&(a-1>=0)},getDaysArray:function(a){var c=[],b;for(b=0;b<this.me.periodRowDayCount;b++){c.push(a[b])}return c},getHeaderClass:function(a){return a===1?this.me.prevPeriodCls:a===7?this.me.nextPeriodCls:""}},constructor:function(a){this.initModel();this.store=new Ext.data.Store({model:"TouchCalendarViewModel"});this.baseTpl=['<table class="{[this.me.mode.toLowerCase()]}">',"<thead>","<tr>",'<tpl for="this.getDaysArray(values)">','<th class="{[this.getHeaderClass(xindex)]}">','<tpl if="xindex === 4">','<span>{[this.me.currentDate.format("F")]} {[this.me.currentDate.format("Y")]}</span>',"</tpl>",'{date:date("D")}',"</th>","</tpl>","</tr>","</thead>","<tbody>","<tr>",'<tpl for=".">','<td class="time-block {[this.getClasses(values)]}" datetime="{[this.me.getDateAttribute(values.date)]}">','{date:date("j")}',"</td>",'<tpl if="this.isEndOfRow(xindex)">',"</tr>",'<tpl if="!this.isEndOfPeriod(xindex)">',"<tr>","</tpl>","</tpl>","</tpl>","</tr>","</tbody>","</table>"];Ext.apply(this,a||{selectionMode:"SINGLE"});this.addEvents("selectionchange","periodchange");this.setMode(this.mode,true);Ext.ux.TouchCalendarView.superclass.constructor.call(this,a);this.minDate=this.minDate?this.minDate.clearTime(true):null;this.maxDate=this.maxDate?this.maxDate.clearTime(true):null;this.on({afterrender:function(){this.scroller.disable()},selectionchange:this.onSelectionChange,scope:this})},onSelectionChange:function(a,b){if(b.length>0){this.setValue(b[0].get("date"))}},initModel:function(){if(!Ext.ModelMgr.getModel("TouchCalendarViewModel")){Ext.regModel("TouchCalendarViewModel",{fields:[{name:"date",type:"date"},{name:"today",type:"boolean"},{name:"unselectable",type:"boolean"},{name:"selected",type:"boolean"},{name:"prevMonth",type:"boolean"},{name:"nextMonth",type:"boolean"},{name:"weekend",type:"boolean"},"timeSlots"]})}},setMode:function(b,a){this.mode=b.toUpperCase();Ext.apply(this,Ext.applyIf(Ext.ux.TouchCalendarView[b.toUpperCase()],{tpl:this.baseTpl}));this.tpl=new Ext.XTemplate(this.tpl.join(""),Ext.apply(this.commonTemplateFunctions,{me:this}));if(this.scroller){this.scroller.moveTo(0,this.el.getY());this.scroller.setEnabled((this.mode==="DAY"))}if(!a){this.refresh();this.selectDate(this.value)}},populateStore:function(){this.currentDate=this.currentDate||this.value||new Date();var c=true,d=this.currentDate,b=this.getStartDate(d),e=this.getTotalDays(d);this.store.suspendEvents();this.store.data.clear();for(var a=0;a<e;a++){b=this.getNextIterationDate(b,(a===0?0:1));c=(this.minDate&&b<this.minDate)||(this.maxDate&&b>this.maxDate);this.store.add({today:this.isSameDay(b,new Date()),unselectable:c,selected:this.isSameDay(b,this.value)&&!c,prevMonth:(b.getMonth()<d.getMonth()),nextMonth:(b.getMonth()>d.getMonth()),weekend:this.isWeekend(b),date:b})}this.store.resumeEvents()},onRender:function(b,a){Ext.ux.TouchCalendarView.superclass.onRender.apply(this,arguments);this.el.on({click:this.onTableHeaderTap,scope:this,delegate:"th"})},refreshDelta:function(d){var b=this.currentDate||new Date();var a=this.getDeltaDate(b,d);if(this.isOutsideMinMax(a)){return}this.currentDate=a;this.refresh();var c=this.getPeriodMinMaxDate();this.fireEvent("periodchange",this,c.min.date,c.max.date,(d>0?"forward":"back"))},getPeriodMinMaxDate:function(){return{min:this.store.data.first(),max:this.store.data.last()}},isOutsideMinMax:function(a){var b=false;if(this.mode==="MONTH"){b=((this.minDate&&a.getLastDateOfMonth()<this.minDate)||(this.maxDate&&a.getFirstDateOfMonth()>this.maxDate))}else{b=((this.minDate&&this.getWeekendDate(a)<this.minDate)||(this.maxDate&&this.getStartDate(a)>this.maxDate))}return b},onTableHeaderTap:function(b,a){a=Ext.fly(a);if(a.hasCls(this.prevPeriodCls)||a.hasCls(this.nextPeriodCls)){this.refreshDelta(a.hasCls(this.prevPeriodCls)?-1:1)}},refresh:function(){this.populateStore();Ext.ux.TouchCalendarView.superclass.refresh.call(this);this.syncHeight()},afterComponentLayout:function(){Ext.ux.TouchCalendarView.superclass.afterComponentLayout.call(this);this.syncHeight()},syncHeight:function(){if(this.mode!=="DAY"){this.el.select("table").first().setHeight(this.el.getHeight())}},setValue:function(a){if(!this.isSameDay(this.value,a)){this.previousValue=this.value;if(Ext.isDate(a)){this.value=a}else{this.value=null}if(this.value){this.currentDate=this.value;this.selectDate(this.value)}}},selectDate:function(a){if(a){var b=this.getDateRecord(a);if(b<0){this.refresh();b=this.getDateRecord(a)}if(b>=0){this.getSelectionModel().select(b)}}},getDateRecord:function(a){return this.store.findBy(function(b){var c=b.get("date").clearTime(true).getTime();return c===a.clearTime(true).getTime()},this)},getDayStartDate:function(a){return a},isSameDay:function(b,a){if(!b||!a){return false}return b.clearTime(true).getTime()===a.clearTime(true).getTime()},isWeekend:function(a){return a.getDay()===0||a.getDay()===6},getWeekendDate:function(b){var a=b.getDay()-this.weekStart;a=a<0?6:a;return new Date(b.getFullYear(),b.getMonth(),b.getDate()+0+a)},getCellDate:function(b){var a=b.dom.getAttribute("datetime");return this.stringToDate(a)},getDateCell:function(a){return this.el.select('td[datetime="'+this.getDateAttribute(a)+'"]').first()},getDateAttribute:function(a){return a.format(this.dateAttributeFormat)},stringToDate:function(a){return Date.parseDate(a,this.dateAttributeFormat)}});Ext.ux.TouchCalendarView.MONTH={dateAttributeFormat:"d-m-Y",getNextIterationDate:function(b,a){return new Date(b.getFullYear(),b.getMonth(),b.getDate()+(a===0?0:1))},getTotalDays:function(a){var b=a.getFirstDateOfMonth();return this.isWeekend(b)?42:35},getStartDate:function(a){return Ext.createDelegate(Ext.ux.TouchCalendarView.WEEK.getStartDate,this)(new Date(a.getFullYear(),a.getMonth(),1))},getDeltaDate:function(b,d){var c=b.getMonth()+d,a=new Date(b.getFullYear(),c,1);a.setDate(a.getDaysInMonth()<b.getDate()?a.getDaysInMonth():b.getDate());return a},periodRowDayCount:7};Ext.ux.TouchCalendarView.WEEK={dateAttributeFormat:"d-m-Y",getNextIterationDate:function(b,a){return new Date(b.getFullYear(),b.getMonth(),b.getDate()+(a===0?0:1))},getTotalDays:function(a){return 7},getStartDate:function(b){var a=b.getDay()-this.weekStart;a=a<0?6:a;return new Date(b.getFullYear(),b.getMonth(),b.getDate()-0-a)},getDeltaDate:function(a,b){return new Date(a.getFullYear(),a.getMonth(),a.getDate()+(b*7))},periodRowDayCount:7};Ext.ux.TouchCalendarView.DAY={dateAttributeFormat:"d-m-Y H:i",tpl:['<table class="{[this.me.mode.toLowerCase()]}">',"<tbody>",'<tpl for=".">',"<tr>",'<td class="time-block" datetime="{[this.me.getDateAttribute(values.date)]}">','{date:date("H:i")}',"</td>","</tr>","</tpl>","</tbody>","</table>"],getNextIterationDate:function(b,a){var c=b.getTime()+((a===0?0:1)*(this.dayTimeSlotSize*60*1000));return new Date(c)},getTotalDays:function(a){return 1440/this.dayTimeSlotSize},getStartDate:function(a){return a.clearTime(true)},getDeltaDate:function(a,b){return new Date(a.getFullYear(),a.getMonth(),a.getDate()+b)},periodRowDayCount:1};Ext.ux.TouchCalendarEvents=Ext.extend(Ext.util.Observable,{startEventField:"start",endEventField:"end",colourField:"colour",eventBarCls:"event-bar",eventWrapperCls:"event-wrapper",eventBarSelectedCls:"event-bar-selected",cellHoverCls:"date-cell-hover",autoUpdateEvent:true,allowEventDragAndDrop:true,eventBarSpacing:1,eventBarTpl:new Ext.XTemplate("{title}"),init:function(a){this.calendar=a;this.calendar.eventsPlugin=this;this.calendar.addEvents("eventtap","eventdragstart","beforeeventdrop","eventdrop","eventdrag");this.calendar.refresh=Ext.createSequence(this.calendar.refresh,this.refreshEvents,this);this.calendar.afterComponentLayout=Ext.createSequence(this.calendar.afterComponentLayout,this.refreshEvents,this)},refreshEvents:function(){this.removeEvents();this.generateEventBars();this.createEventWrapper();this.renderEventBars(this.eventBarStore);if(this.allowEventDragAndDrop){this.createDroppableRegion()}},createDroppableRegion:function(){var b=this;var a=0;this.droppable=new Ext.util.Droppable(this.calendar.getEl(),{onDrag:function(c,h){if(c.el.hasCls(b.eventBarCls)){this.setCanDrop(this.isDragOver(c),c,h);a++;if(a%15===0){var g,f,d=b.getEventRecord(c.el.getAttribute("eventID"));b.calendar.all.removeCls(b.cellHoverCls);b.calendar.all.each(function(e,i){var j=e.getPageBox(true);var k=c.el.getPageBox(true);if(j.partial(k)){g=e;f=this.calendar.getCellDate(e);e.addCls(b.cellHoverCls);return}},b);b.calendar.fireEvent("eventdrag",c,d,f,g,h);a=0}}}});this.droppable.on({drop:this.onEventDrop,dropdeactivate:this.onEventDropDeactivate,scope:this})},onEventDropDeactivate:function(f,a,d,c){if(a.el.hasCls(this.eventBarCls)){var b=this.getEventRecord(a.el.getAttribute("eventID"));this.calendar.getEl().select("div."+b.internalId).each(function(e){e.show()},this)}},onEventDrop:function(f,a,d,c){var b=false;this.calendar.all.each(function(e){var j=e.getPageBox(true);var k=a.el.getPageBox(true);if(j.partial(k)&&this.calendar.fireEvent("beforeeventdrop",a,f,g,d)){b=true;var g=this.getEventRecord(a.el.getAttribute("eventID")),h=this.calendar.getCellDate(e),i=this.getDaysDifference(g.get(this.startEventField),h);if(this.autoUpdateEvent){g.set(this.startEventField,h);g.set(this.endEventField,g.get(this.endEventField).add(Date.DAY,i))}this.refreshEvents();this.calendar.fireEvent("eventdrop",a,f,g,d);return}},this);this.calendar.all.removeCls(this.cellHoverCls);if(!b){a.setOffset(a.startOffset,true)}},generateEventBars:function(){this.eventBarStore=new Ext.data.Store({model:"Ext.ux.CalendarEventBarModel",data:[]});var c=this.calendar.store;var a=this.calendar.eventStore;var b;c.each(function(e){var d=e.get("date"),f=d.clearTime(true).getTime(),g=[];a.filterBy(function(i){var h=i.get(this.startEventField).clearTime(true).getTime(),j=i.get(this.endEventField).clearTime(true).getTime();return(h<=f)&&(j>=f)},this);a.sort(this.startEventField,"ASC");a.each(function(i){var k=this.eventBarStore.findBy(function(l,m){return l.get("EventID")===i.internalId},this);if(k>-1){b=this.eventBarStore.getAt(k);while(b.linked().getCount()>0){b=b.linked().getAt(b.linked().getCount()-1)}if(d.getDay()===this.calendar.weekStart){g.push(b.get("BarPosition"));var h=Ext.ModelMgr.create({EventID:i.internalId,Date:d,BarLength:1,BarPosition:b.get("BarPosition"),Colour:b.get("Colour"),Record:i},"Ext.ux.CalendarEventBarModel");b.linked().add(h)}else{g.push(b.get("BarPosition"));b.set("BarLength",b.get("BarLength")+1)}}else{var j=this.getNextFreePosition(g);g.push(j);b=Ext.ModelMgr.create({EventID:i.internalId,Date:d,BarLength:1,BarPosition:j,Colour:this.getRandomColour(),Record:i},"Ext.ux.CalendarEventBarModel");this.eventBarStore.add(b)}},this);a.clearFilter()},this)},renderEventBars:function(a){var b=this;a.each(function(h){var n=this.getEventRecord(h.get("EventID")),k=this.calendar.getDateCell(h.get("Date")),o=this.eventBarDoesWrap(h),g=this.eventBarHasWrapped(h);var p=Ext.DomHelper.append(this.eventWrapperEl,{tag:"div",style:{"background-color":n.get(this.colourField)},html:this.eventBarTpl.apply(n.data),eventID:h.get("EventID"),cls:this.eventBarCls+" "+h.get("EventID")+(o?" wrap-end":"")+(g?" wrap-start":"")},true);if(this.allowEventDragAndDrop){new Ext.util.Draggable(p,{revert:true,onStart:function(u){var q=this,t=q.el.getAttribute("eventID"),r=b.getEventRecord(t),s=b.getEventBarRecord(t);q.el.setWidth(q.el.getWidth()/s.get("BarLength"));q.el.setLeft(u.startX-(q.el.getWidth()/2));b.calendar.getEl().select("div."+r.internalId).each(function(v){if(v.dom!==q.el.dom){v.hide()}},this);Ext.util.Draggable.prototype.onStart.apply(this,arguments);b.calendar.fireEvent("eventdragstart",q,r,u);return true}})}var m=h.get("BarPosition"),d=h.get("BarLength"),j=k.getX(),i=k.getY(),c=k.getHeight(),f=k.getWidth(),e=p.getHeight(),l=this.eventBarSpacing;console.log(k);console.log(i);p.setLeft(j+(g?0:l));p.setTop((((i-this.calendar.getEl().getY())+c)-e)-((m*e+(m*l)+l)));p.setWidth((f*d)-(l*(o?(o&&g?0:1):2)));if(h.linked().getCount()>0){this.renderEventBars(h.linked())}},this)},onEventDragStart:function(a,f){var d=a.el.getAttribute("eventID"),b=this.getEventRecord(d),c=this.getEventBarRecord(d);a.el.setWidth(a.el.getWidth()/c.get("BarLength"));a.updateBoundary(true);this.calendar.getEl().select("div."+b.internalId).each(function(e){if(e.dom!==a.el.dom){e.hide()}},this);this.calendar.fireEvent("eventdragstart",a,b,f)},eventBarDoesWrap:function(a){var b=a.get("Date").add(Date.DAY,(a.get("BarLength")-1));return b.clearTime(true).getTime()!==a.get("Record").get(this.endEventField).clearTime(true).getTime()},eventBarHasWrapped:function(a){return a.get("Date").clearTime(true).getTime()!==a.get("Record").get(this.startEventField).clearTime(true).getTime()},createEventWrapper:function(){if(this.calendar.rendered&&!this.eventWrapperEl){this.eventWrapperEl=Ext.DomHelper.append(this.getEventsWrapperContainer(),{tag:"div",cls:this.eventWrapperCls},true);this.calendar.mon(this.eventWrapperEl,"click",this.onEventWrapperTap,this,{delegate:"div."+this.eventBarCls})}},onEventWrapperTap:function(d,c){var b=c.attributes.eventID;if(b){var a=this.getEventRecord(c.attributes.eventID.value);this.deselectEvents();this.eventWrapperEl.select("div."+a.internalId).addCls(this.eventBarSelectedCls);this.calendar.fireEvent("eventtap",a,d)}},getEventsWrapperContainer:function(){return this.calendar.getEl().select("thead th").first()||this.calendar.getEl().select("tr td").first()},getNextFreePosition:function(a){var b=0;while(a.indexOf(b)>-1){b++}return b},getEventRecord:function(a){var b=this.calendar.eventStore.findBy(function(c){return c.internalId===a},this);return this.calendar.eventStore.getAt(b)},getEventBarRecord:function(a){var b=this.eventBarStore.findBy(function(c){return c.get("EventID")===a},this);return this.eventBarStore.getAt(b)},deselectEvents:function(){this.calendar.getEl().select("."+this.eventBarSelectedCls).removeCls(this.eventBarSelectedCls)},getDaysDifference:function(b,a){b=b.clearTime(true).getTime();a=a.clearTime(true).getTime();return(a-b)/1000/60/60/24},removeEvents:function(){if(this.eventWrapperEl){this.eventWrapperEl.dom.innerHTML="";this.eventWrapperEl.remove();this.eventWrapperEl=null}if(this.eventBarStore){this.eventBarStore.remove(this.eventBarStore.getRange());this.eventBarStore=null}if(this.droppable){this.droppable=null}},getRandomColour:function(){return"#"+(Math.random()*16777215<<0).toString(16)}});Ext.regModel("Ext.ux.CalendarEventBarModel",{fields:[{name:"EventID",type:"string"},{name:"Date",type:"date"},{name:"BarLength",type:"int"},{name:"BarPosition",type:"int"},{name:"Colour",type:"string"},"Record"],hasMany:[{model:"Ext.ux.CalendarEventBarModel",name:"linked"}]});Ext.override(Ext.util.Region,{partial:function(g){var f=this,e=g.right-g.left,c=g.bottom-g.top,b=f.right-f.left,a=f.bottom-f.top,d=g.top>f.top&&g.top<f.bottom;horizontalValid=g.left>f.left&&g.left<f.right;return horizontalValid&&d}});Ext.ux.TouchCalendarSimpleEvents=Ext.extend(Ext.util.Observable,{startEventField:"start",endEventField:"end",multiEventDots:true,wrapperCls:"simple-event-wrapper",eventDotCls:"simple-event",dotWidth:6,eventTpl:new Ext.XTemplate('<span class="{wrapperCls}">','<tpl for="events">','<span class="{[parent.eventDotCls]}"></span>',"</tpl>","</span>"),filterFn:function(c,e,b){var a=c.get(this.startEventField).clearTime(true).getTime(),d=c.get(this.endEventField).clearTime(true).getTime(),b=b.clearTime(true).getTime();return(a<=b)&&(d>=b)},init:function(a){this.calendar=a;this.calendar.simpleEventsPlugin=this;this.wrapperCls=this.wrapperCls+(this.multiEventDots?"-multi":"");this.eventDotCls=this.eventDotCls+(this.multiEventDots?"-multi":"");this.calendar.showEvents=this.showEvents;this.calendar.hideEvents=this.hideEvents;this.calendar.removeEvents=this.removeEvents;this.calendar.syncHeight=Ext.createSequence(this.calendar.syncHeight,this.refreshEvents,this)},refreshEvents:function(){if(!this.disabled){var a=this.calendar.store;if(a&&this.calendar.isVisible()){this.removeEvents();a.each(function(d){var f=d.get("date");var c=this.calendar.getDateCell(f);var e=this.calendar.eventStore;if(c){e.clearFilter();var b=e[this.multiEventDots?"filterBy":"findBy"](Ext.createDelegate(this.filterFn,this,[f],true));var i=e.getRange().length;if((!this.multiEventDots&&b>-1)||(this.multiEventDots&&i>0)){var h=Math.min((c.getWidth()/this.dotWidth),i);var g=this.eventTpl.append(c,{events:(this.multiEventDots?e.getRange().slice(0,h):["event"]),wrapperCls:this.wrapperCls,eventDotCls:this.eventDotCls},true);g.setWidth(Math.min((this.multiEventDots?e.getRange().length:1)*this.dotWidth,c.getWidth()));g.setY((c.getY()+c.getHeight())-(g.getHeight()+(c.getHeight()*0.1)));g.setX((c.getX()+(c.getWidth()/2))-(g.getWidth()/2))}}},this)}}},hideEvents:function(){this.simpleEventsPlugin.disabled=true;this.calendar.el.select("span."+this.wrapperCls).hide()},showEvents:function(){this.simpleEventsPlugin.disabled=false;this.calendar.el.select("span."+this.wrapperCls).show()},removeEvents:function(){if(this.calendar.el){this.calendar.el.select("span."+this.wrapperCls).remove()}}});